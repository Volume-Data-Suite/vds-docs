<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Render Backend - Volume Data Suite Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="supported_plattforms.html"><strong aria-hidden="true">2.</strong> Supported Plattforms</a></li><li class="chapter-item expanded "><a href="about_volume_data.html"><strong aria-hidden="true">3.</strong> About Volume Data</a></li><li class="chapter-item expanded "><a href="importing_static_volume_data.html"><strong aria-hidden="true">4.</strong> Importing Static Volume Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="file_format_raw_3d.html"><strong aria-hidden="true">4.1.</strong> File Format: RAW 3D</a></li></ol></li><li class="chapter-item expanded "><a href="visualization.html"><strong aria-hidden="true">5.</strong> Visualization</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="render_backend.html" class="active"><strong aria-hidden="true">5.1.</strong> Render Backend</a></li></ol></li><li class="chapter-item expanded "><a href="development.html"><strong aria-hidden="true">6.</strong> Development</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Volume Data Suite Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="render-backend"><a class="header" href="#render-backend">Render Backend</a></h1>
<p>VDS uses the <a href="https://wgpu.rs/">wgpu</a> graphics API to render all visualizations. Shaders are written in the <a href="https://gpuweb.github.io/gpuweb/wgsl/">WebGPU Shading Language</a> also known as <code>WGSL</code> and can be translated to various native graphics APIs like Vulkan, DirectX or Metal. This is why VDS supports so many different plattforms listed on <a href="/supported_plattforms.html">Supported Plattforms</a>.</p>
<h2 id="wgpu-coordinate-system"><a class="header" href="#wgpu-coordinate-system">wgpu Coordinate System</a></h2>
<p>Since all graphics pipelines are written with wgpu and WGSL, the underlying <a href="https://www.w3.org/TR/webgpu/#coordinate-systems">coordinate system is the one from WebGPU</a>, which is identical to the coordinate system of DirectX and Metal.</p>
<blockquote>
<p>Note: All custom shaders must be compliant with the WebGPU coordinate system, no matter which graphic API backend is used by the plattform. All coordinates will be transformed by wgpu to match the plattform graphics API coordinate system. So do not assume the coordinate system of for example Vulkan when VDS uses Vulkan as render backend.</p>
</blockquote>
<h3 id="normalized-device-coordinate-system"><a class="header" href="#normalized-device-coordinate-system">Normalized device coordinate system</a></h3>
<p>Normalized device coordinates use a <code>left-handed coordinate system</code> and map to positions in the viewport. These coordinates are independent of viewport size. The bottom-left corner is at (-1.0, -1.0, z). Positive-z values point away from the camera (&quot;into the screen&quot;) and are clipped between 0.0 and 1.0.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center"><img src="images/ndc.svg" alt="Normalized device coordinate system"/></th></tr></thead><tbody>
<tr><td style="text-align: center"><em>Normalized device coordinate system</em></td></tr>
</tbody></table>
</div>
<h3 id="framebuffer-coordinate-system"><a class="header" href="#framebuffer-coordinate-system">Framebuffer coordinate system</a></h3>
<p>Framebuffer coordinates adress pixels in the framebuffer and have two dimensions (x, y). Those dimensions are not normalized, so each pixel extends 1 unit in x and y dimensions. The top-left corner is at (0, 0).</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center"><img src="images/framebuffer.svg" alt="Framebuffer coordinate system"/></th></tr></thead><tbody>
<tr><td style="text-align: center"><em>Framebuffer coordinate system</em></td></tr>
</tbody></table>
</div>
<h3 id="2d-texture-coordinates"><a class="header" href="#2d-texture-coordinates">2D Texture Coordinates</a></h3>
<p>2D textures us a normalized coordinate system. The origin of a 2D texture is a the top-left corner with +Y facing down. Sometimes uv coordinates are used to describe a texture coordinate, where (u, v) is equal to (x, y).</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center"><img src="images/2d_texture_coordinates.svg" alt="2D texture coordinates"/></th></tr></thead><tbody>
<tr><td style="text-align: center"><em>2D texture coordinates</em></td></tr>
</tbody></table>
</div>
<h3 id="3d-texture-coordinates"><a class="header" href="#3d-texture-coordinates">3D Texture Coordinates</a></h3>
<p>3D textures us a normalized coordinate system. The origin of a 3D texture is a the top-left-front corner with +Y facing down and +Z facing back, similiar to <a href="https://learn.microsoft.com/en-us/windows/win32/direct3d11/overviews-direct3d-11-resources-textures-intro#3d-textures">DirectX 11</a>. Sometimes uvw coordinates are used to describe a texture coordinate, where (u, v, w) is equal to (x, y, z).</p>
<h2 id="differnces-to-other-apis-like-opengl-and-vulkan"><a class="header" href="#differnces-to-other-apis-like-opengl-and-vulkan">Differnces to other APIs like OpenGL and Vulkan</a></h2>
<p>Other graphics APIs like OpenGL and Vulkan use different coordinate systems. This section aims to highlight the differences between those coordinate systems to mitigate misunderstandings.</p>
<h3 id="webgpu--directx--metal"><a class="header" href="#webgpu--directx--metal">WebGPU &amp; DirectX &amp; Metal</a></h3>
<p><strong>NDC:</strong> +Y is up. Point (-1, -1) is at the bottom left corner.<br />
<strong>Framebuffer coordinates:</strong> +Y is down. Origin (0, 0) is at the top left corner.<br />
<strong>2D Texture coordinates:</strong> +Y is down. Origin (0, 0) is at the top left corner.</p>
<h3 id="opengl--opengl-es--webgl"><a class="header" href="#opengl--opengl-es--webgl">OpenGL &amp; OpenGL ES &amp; WebGL</a></h3>
<p><strong>NDC:</strong> +Y is up. Point (-1, -1) is at the bottom left corner.<br />
<strong>Framebuffer coordinates:</strong> +Y is up. Origin (0, 0) is at the bottom left corner.<br />
<strong>2D Texture coordinates:</strong> +Y is up. Origin (0, 0) is at the bottom left corner.</p>
<h3 id="vulkan"><a class="header" href="#vulkan">Vulkan</a></h3>
<p><strong>NDC:</strong> +Y is down. Point (-1, -1) is at the top left corner.<br />
<strong>Framebuffer coordinates:</strong> +Y is down. Origin (0, 0) is at the bottom left corner.<br />
<strong>2D Texture coordinates:</strong> +Y is up. Origin (0, 0) is at the bottom left corner.</p>
<h2 id="3d-volume-scaling"><a class="header" href="#3d-volume-scaling">3D Volume Scaling</a></h2>
<p>VDS only supports uniform and non-uniform volume data that is represented as a regular grid of voxels. This means, that each that the distance between all voxels must be identical on the same axis.</p>
<!-- TODO: include visual examples here -->
<p>Not supported a irregular or non-linear distance between voxels along either axis.</p>
<p>During the import process, the bounding box of the volume data is normalized. This means, that aspect ratio of the volume is applied to the bounding box and afterwards the volume gets scaled in a way, that the longest side of the bounding box equals a length of 1.0.</p>
<h2 id="z-values-and-depth-buffer"><a class="header" href="#z-values-and-depth-buffer">Z-Values and Depth Buffer</a></h2>
<p><code>Z-Values</code> represent the distance of a pixel from the camera in projection coordinates. The near clipping plane is set to <strong>0.1</strong> and the far clipping plane is set to <strong>10.0</strong> which results in a in far-plane/near-plane ratio of 100. At a ratio of 100, 90 percent of the precision range is spent on the first 10 percent of the depth range (<a href="https://learn.microsoft.com/en-us/windows/win32/direct3d9/depth-buffers">D3D Docs</a>). This is suitable for all volume renderers of VDS, since the bounding box of the volume data is always normalized due to the <a href="#3d-volume-scaling">3D Volume Scaling</a>.</p>
<p>The <code>Depth Buffer</code> contains depth values between 0.0 and 1.0, where 0.0 is the closest distance and 1.0 is the furthest distance. All Z-Values get mapped from the range of the near-plane - far-plane to the range of 0.0 - 1.0 respectively. VDS uses <a href="https://docs.rs/wgpu/latest/wgpu/enum.TextureFormat.html#variant.Depth32Float">wgpu::TextureFormat::Depth32Float</a> for the depth buffer.</p>
<h3 id="depth-buffer-and-ray-marching"><a class="header" href="#depth-buffer-and-ray-marching">Depth Buffer and Ray Marching</a></h3>
<p>The depth of each pixel is set to first sample point the ray that exceeds the threshold value.</p>
<p>For non-translusent visualization methods like &quot;First Hit&quot; the depth value is set accordingly to the visible surface shown on the screen.</p>
<p>For translusent visualisation methods like &quot;Accumulate&quot; the depth value is set accordingly to the first visible layer shown on the screen, even if it extremely translucent and barly visible. This is due to the fact that depth values are assigned to a pixel, while the pixel color value is calculated by accumulating all the samples in the raymarching ray.</p>
<!-- TODO: Visual debugging
## Visual Debugging

### Coordinates
Visualise position in 3D space with RGB to determine correct orientation in the 3D space coordinate system. Different options are:
- texture coordinates
- bounding box coordinates
- world coordinates
- projection coordinates
- global egui viewport coordinates
- tab view viewport coordinates

### Depth Buffer


### Gradients & Normal Map -->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="visualization.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="development.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="visualization.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="development.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
